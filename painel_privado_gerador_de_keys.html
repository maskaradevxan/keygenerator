<script>
  // ===== CONFIG ADMIN =====
  const ADMIN_USER = 'celes';
  const ADMIN_PASS = 'clean';

  const storeKey = 'cln_keys_v1';
  const keys = JSON.parse(localStorage.getItem(storeKey) || '[]');

  const $ = (id)=>document.getElementById(id);

  function login(){
    if($('u').value === ADMIN_USER && $('p').value === ADMIN_PASS){
      $('login').classList.add('hidden');
      $('panel').classList.remove('hidden');
      render();
    }else{
      $('lmsg').textContent = 'Credenciais inválidas.';
    }
  }

  function rnd(){
    const a='ABCDEFGHIJKLMNOPQRSTUVWXYZ';
    let s='';
    for(let i=0;i<5;i++) s+=a[Math.floor(Math.random()*a.length)];
    return s;
  }

  function generate(){
    const p = ($('prefix').value || 'CLN').toUpperCase();
    const sel = $('exp');
    const expDays = parseInt(sel.value,10);
    const tag = sel.options[sel.selectedIndex].dataset.tag;

    const expAt = expDays === 0 ? null : (Date.now() + expDays*24*60*60*1000);
    const key = `${p}-${tag}-${rnd()}-${rnd()}-${rnd()}`;

    keys.unshift({ key, expAt, tag });
    localStorage.setItem(storeKey, JSON.stringify(keys));
    render();
  }

  function validate(){
    const k = $('check').value.trim();
    const found = keys.find(x=>x.key === k);

    if(!found){
      $('vmsg').innerHTML = '<span class="warn">Key não encontrada.</span>';
      return;
    }

    if(found.expAt !== null && Date.now() > found.expAt){
      $('vmsg').innerHTML = '<span class="warn">Key expirada.</span>';
      return;
    }

    $('vmsg').innerHTML = `<span class="ok">Key válida (${found.tag}).</span>`;
  }

  function render(){
    const list = $('list');
    list.innerHTML = '';

    keys.forEach(x=>{
      const d = document.createElement('div');
      d.className='item';

      let expTxt = 'Lifetime';
      if(x.expAt !== null){
        expTxt = new Date(x.expAt).toLocaleDateString('pt-BR');
      }

      d.innerHTML = `
        <div class="k">${x.key}</div>
        <small>Plano: ${x.tag} • Expira em: ${expTxt}</small>
      `;
      list.appendChild(d);
    });

    $('now').textContent = new Date().toLocaleString('pt-BR');
  }
</script>
